(this.webpackJsonpchatter=this.webpackJsonpchatter||[]).push([[10],{103:function(e,t,a){},104:function(e,t,a){},112:function(e,t,a){"use strict";a.r(t);var n=a(38),c=a(36),s=a(32),r=a(46),i=a(42),u=a(0),o=a(39),l=a(44),d=a(53),j=a(105),h=a(100),b=a.n(h),f=a(102),O=a(110),v=a(35),p=a(54),m=a(45),g=(a(103),function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t="ASDFGHJKLPOIUYTREWQZXCVBNMasdfghjklpoiuytrewqzxcvbnm1234567890",a="",n=0;n<e;n++)a+=t[x(n)];return a}),x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:61;return Math.floor(Math.random()*t+e)},N=a(3),y=function(e){var t=Object(u.useState)(""),a=Object(s.a)(t,2),n=a[0],c=a[1],h=Object(u.useState)(""),x=Object(s.a)(h,2),y=x[0],G=x[1],k=Object(u.useState)(l.r),C=Object(s.a)(k,2),w=C[0],M=C[1],S=Object(u.useState)([]),U=Object(s.a)(S,2),T=U[0],L=U[1],R=Object(u.useState)([]),P=Object(s.a)(R,2),F=P[0],D=P[1];Object(u.useEffect)((function(){(new v.a).getLiveUpdateOfUser((function(e){return e.exists()&&D(Object(p.c)(e.val()))}))}),[]);var B=function(){var t=Object(f.a)(b.a.mark((function t(){var a,c,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=Object(O.a)(n+g(),o.f),c=new d.a,s=new v.a,c.createGroup({id:a,name:n,userIdList:T.map((function(e){return e.id})).filter((function(e){return null!=e}))}).then((function(){return e.hideCreateGroup()})).catch((function(e){return Object(l.c)(l.m)})),T.forEach((function(e){s.updateUserGroupData(e.id,a).then().catch((function(e){M(Object(l.c)(l.l))}))}));case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(N.jsxs)("section",{className:"createNewWrapper center",children:[Object(N.jsxs)("div",{className:"newGroup center",children:[Object(N.jsxs)("div",{className:"newGroupForm center",children:[Object(N.jsx)("input",{type:"text",placeholder:"Group Name...",onChange:function(e){return c(e.target.value)}}),Object(N.jsx)("input",{type:"text",placeholder:"Search Users...",onChange:function(e){return G(e.target.value)}}),Object(N.jsx)("div",{className:"suggestions",children:Object(N.jsx)("div",{className:"suggestedUsers",children:Object.keys(F).map((function(e){return(t=F[e]).name.toLowerCase().includes(y.toLowerCase())&&y.length>=3&&0===T.filter((function(e){return e.id===t.id})).length?Object(N.jsxs)("span",{className:"button",onClick:function(){return function(e){return L([].concat(Object(j.a)(T),[e]))}(F[e])},children:[F[e].name,Object(N.jsxs)("span",{children:["(",F[e].email,")"]})]},F[e].id):null;var t}))})}),Object(N.jsx)("div",{className:"selectedUsersList",children:T.map((function(e,t){return Object(N.jsxs)("div",{className:"userDetails",children:[Object(N.jsx)("span",{children:e.name}),Object(N.jsx)("span",{className:"button",onClick:function(){return function(e){var t=JSON.parse(JSON.stringify(T));t.splice(e,1),L(t)}(t)},children:"X"})]},t)}))}),Object(N.jsx)("div",{className:"createGroupButton center button",onClick:B,children:Object(N.jsx)("p",{children:"Create Group"})})]}),Object(N.jsxs)("div",{className:"closeForm",children:[Object(N.jsxs)("div",{className:"button searchButton",onClick:e.hideAndOpenSearchGroup,children:[Object(N.jsx)(i.a,{icon:r.j}),Object(N.jsx)("span",{children:"Search Group"})]}),Object(N.jsxs)("div",{className:"button closeButton",onClick:e.hideCreateGroup,children:[Object(N.jsx)(i.a,{icon:r.a}),Object(N.jsx)("span",{children:"Close"})]})]})]}),Object(N.jsx)(m.a,{time:1,message:w.message,type:w.type,showToast:w.showToast})]})},G=a(67),k=(a(104),a(50)),C=a(69),w=a(31);t.default=function(e){var t=Object(u.useState)(l.r),a=Object(s.a)(t,2),j=a[0],h=a[1],b=Object(u.useState)(!1),f=Object(s.a)(b,2),O=f[0],g=f[1],x=Object(u.useState)(""),M=Object(s.a)(x,2),S=M[0],U=M[1],T=Object(u.useState)(!1),L=Object(s.a)(T,2),R=L[0],P=L[1],F=Object(u.useState)([]),D=Object(s.a)(F,2),B=D[0],A=D[1],E=Object(u.useRef)({}),I=Object(u.useState)({}),J=Object(s.a)(I,2),W=J[0],q=J[1],V=Object(u.useState)({}),X=Object(s.a)(V,2),z=X[0],H=X[1],K=Object(u.useState)({}),Q=Object(s.a)(K,2),Y=Q[0],Z=Q[1];Object(u.useEffect)((function(){var e=new v.a,t=new d.a;return e.getCurrentUserData(ee),t.getGroups(te),function(){var e,t=new k.a;E.current.id&&(null===(e=t.setLastReadTime(E.current.id,o.c))||void 0===e||e.then().catch());E.current={id:"",name:"",userIdList:[]}}}),[]),Object(u.useEffect)((function(){var e=new k.a;B.forEach((function(t){e.getLastMessageOfGroup(t.id,$),e.getMessagesForGroup(t.id,_)}))}),[B]);var $=function(e,t){if(t.exists()){var a=t.val()[Object.keys(t.val())[0]];Z((function(t){return Object(c.a)(Object(c.a)({},t),{},Object(n.a)({},e,(null===a||void 0===a?void 0:a.message)||""))}))}},_=function(e,t){if(e.exists()){var a,s,r,i=new k.a;if((null===(a=E.current)||void 0===a?void 0:a.id)===t)null===(s=i.setLastReadTime(t,o.c))||void 0===s||s.then().catch();else null===(r=i.getLastReadTime(t,o.c))||void 0===r||r.then((function(a){H((function(s){return Object(c.a)(Object(c.a)({},s),{},Object(n.a)({},t,Object(C.a)(a.val(),e)))}))})).catch((function(e){h(Object(l.c)(l.l)),Object(w.a)(1,ae)}))}},ee=function(e){e.exists()&&q(e.val())},te=function(e){e.exists()&&A(Object(p.b)(e.val()))},ae=function(){return h(l.r)},ne=function(e){g(!1),P(e)};return Object(N.jsxs)("section",{className:"groupChatListWrapper",children:[Object(N.jsxs)("div",{className:"heading",children:[Object(N.jsx)("h1",{className:"naming center",children:"Group Chats"}),Object(N.jsxs)("div",{className:"createGroupbutton button",onClick:function(){return g(!0)},children:[Object(N.jsx)(i.a,{icon:r.h}),"Create New Group"]})]}),Object(N.jsxs)("div",{className:"searchBar center",children:[Object(N.jsx)(i.a,{icon:r.j}),Object(N.jsx)("input",{type:"search",placeholder:"Search for Group...",onChange:function(e){return U(e.target.value)}})]}),Object(N.jsx)("div",{className:"groupList",children:Object(N.jsx)("ul",{children:B.filter((function(e){return W.groups[e.id]})).filter((function(e){return!S||e.name.toLowerCase().includes(S.toLowerCase())})).map((function(t){return Object(N.jsxs)("li",{className:E.current.id===t.id?"button active":"button",onClick:function(){var a;!function(t){E.current.id&&(new k.a).setLastReadTime(E.current.id,o.c),E.current=t,e.setActiveGroup(t)}(t),a=t.id,H(Object(c.a)(Object(c.a)({},z),{},Object(n.a)({},a,0)))},children:[Object(N.jsx)("h2",{className:"groupName",children:t.name}),Object(N.jsxs)("p",{className:"lastMessage",children:[Object(N.jsx)("span",{className:"latestMessage",children:Y[t.id]?Y[t.id]:""}),z[t.id]?Object(N.jsx)("span",{className:"messageCount center",children:z[t.id]}):null]})]},t.id)}))})}),R&&Object(N.jsx)(G.a,{hideSearchPopUp:function(){return P(!1)},searchType:o.a}),O&&Object(N.jsx)(y,{hideCreateGroup:function(){return ne(!1)},hideAndOpenSearchGroup:function(){return ne(!0)}}),Object(N.jsx)(m.a,{time:1,message:j.message,type:j.type,showToast:j.showToast})]})}},50:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(38),c=a(36),s=a(33),r=a(34),i=a(39),u=a(43),o=a(31),l=a(37),d=function(){function e(){Object(s.a)(this,e),this.database=void 0,this.auth=void 0,this.database=l.a.database(),this.auth=l.a.auth()}return Object(r.a)(e,[{key:"getUserChatRef",value:function(){return this.database.ref().child("userchats")}},{key:"getGroupChatRef",value:function(){return this.database.ref().child("/groupchats")}},{key:"getMessagePathToFriend",value:function(e){var t,a=(null===(t=this.auth.currentUser)||void 0===t?void 0:t.email)||"";return this.getUserChatRef().child(Object(o.b)(a,e)).child("/messages/")}},{key:"getMessageMetaDataPath",value:function(e){var t,a=(null===(t=this.auth.currentUser)||void 0===t?void 0:t.email)||"";return this.getUserChatRef().child(Object(o.b)(a,e)).child("/metaData/")}},{key:"getGroupPath",value:function(e){return this.getGroupChatRef().child(e).child("/messages/")}},{key:"getMessageMetaDataPathForGroup",value:function(e){return this.getGroupChatRef().child(e).child("/metaData/")}},{key:"getMessagesOnce",value:function(e,t){return this.getMessagePathToFriend(e).on(u.c,(function(a){return t(a,e)}),(function(e){}))}},{key:"getMessagesForGroup",value:function(e,t){this.getGroupPath(e).on("value",(function(a){return t(a,e)}))}},{key:"sendMessage",value:function(e,t){var a,s=(null===(a=this.auth.currentUser)||void 0===a?void 0:a.email)||"";return this.getMessagePathToFriend(e).update(Object(n.a)({},t.timestamp,Object(c.a)(Object(c.a)({},t),{},{from:s})))}},{key:"sendMessageToGroup",value:function(e,t){var a,s=(null===(a=this.auth.currentUser)||void 0===a?void 0:a.email)||"";return this.getGroupPath(e).update(Object(n.a)({},t.timestamp,Object(c.a)(Object(c.a)({},t),{},{from:s})))}},{key:"getLastMessage",value:function(e,t){return this.getMessagePathToFriend(e).orderByValue().limitToLast(1).on("value",(function(a){return t(e,a)}))}},{key:"getLastMessageOfGroup",value:function(e,t){return this.getGroupPath(e).orderByValue().limitToLast(1).on("value",(function(a){return t(e,a)}))}},{key:"getLastReadTime",value:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.h,n=Object(o.c)((null===(t=this.auth.currentUser)||void 0===t?void 0:t.email)||"");return a===i.h?this.getMessageMetaDataPath(e).child("lastMessageReadTime").child(n).get():a===i.c?this.getMessageMetaDataPathForGroup(e).child("lastMessageReadTime").child(n).get():void 0}},{key:"setLastReadTime",value:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.h,n=Object(o.c)((null===(t=this.auth.currentUser)||void 0===t?void 0:t.email)||"");return a===i.h?this.getMessageMetaDataPath(e).child("lastMessageReadTime").child(n).set((new Date).getTime()):a===i.c?this.getMessageMetaDataPathForGroup(e).child("lastMessageReadTime").child(n).set((new Date).getTime()):void 0}}]),e}()},53:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(38),c=a(36),s=a(33),r=a(34),i=a(31),u=a(37),o=function(){function e(){Object(s.a)(this,e),this.firebaseDataBase=void 0,this.firebaseAuth=void 0,this.firebaseDataBase=u.a.database(),this.firebaseAuth=u.a.auth()}return Object(r.a)(e,[{key:"refForGroup",value:function(){return this.firebaseDataBase.ref("/group")}},{key:"getCurrentUser",value:function(){return this.firebaseAuth.currentUser}},{key:"createGroup",value:function(e){return this.refForGroup().update(Object(n.a)({},e.id,Object(c.a)({},e)))}},{key:"getGroups",value:function(e){this.refForGroup().on("value",e)}},{key:"exitGroup",value:function(e){var t,a=Object(i.c)((null===(t=this.getCurrentUser())||void 0===t?void 0:t.email)||"");return this.refForGroup().child(e.id).update(Object(c.a)(Object(c.a)({},e),{},{userIdList:e.userIdList.filter((function(e){return e!==a}))}))}}]),e}()},54:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return r}));var n=a(31),c=function(e,t,a){return Object.keys(t[Object(n.c)(a)].friends||{}).forEach((function(e){return t[e]=null})),t[Object(n.c)(a)]=null,Object.keys(t).map((function(a){return t[a]&&(t[a].email.includes(e)||t[a].name.includes(e))?t[a]:null})).filter((function(e){return null!=e}))},s=function(e){return Object.keys(e).map((function(t){return e[t]})).filter((function(e){return e}))},r=function(e){var t={};return Object.keys(e).forEach((function(a){t[a]={id:a,name:e[a].name,active:e[a].active,email:e[a].email,profileUrl:e[a].profileUrl,groups:e[a].groups}})),t}},67:function(e,t,a){"use strict";var n=a(32),c=a(46),s=a(42),r=a(0),i=a(44),u=a(35),o=a(31),l=a(54),d=a(45),j=(a(68),a(3));t.a=function(e){var t=Object(r.useState)([]),a=Object(n.a)(t,2),h=a[0],b=a[1],f=Object(r.useState)(!1),O=Object(n.a)(f,2),v=O[0],p=O[1],m=Object(r.useState)(""),g=Object(n.a)(m,2),x=g[0],N=g[1],y=Object(r.useState)(i.r),G=Object(n.a)(y,2),k=G[0],C=G[1],w=function(){return C(i.r)};return Object(j.jsxs)("div",{className:"userSearchPopUP",children:[Object(j.jsxs)("div",{className:"searchWrapper",children:[Object(j.jsxs)("div",{className:"searchBar",children:[Object(j.jsx)("input",{type:"search",placeholder:"Search for Friends....",onChange:function(e){return N(e.target.value)}}),Object(j.jsxs)("div",{className:"center",onClick:function(){if(x.length>3){var e=new u.a,t=e.getCurrentUser();e.getAllUsers().then((function(e){b(Object(l.a)(x,e,(null===t||void 0===t?void 0:t.email)||""))})).catch((function(e){return b([])})),p(!0)}else C(Object(i.v)(i.j)),Object(o.a)(1,w)},children:[Object(j.jsx)(s.a,{icon:c.j}),"Search"]})]}),Object(j.jsxs)("div",{className:"searchResults",children:[h.length>0&&v&&h.map((function(e,t){return Object(j.jsx)("ul",{className:"resultsList",children:Object(j.jsx)("li",{className:"result",children:Object(j.jsxs)("div",{className:"requestBox",children:[Object(j.jsx)("img",{src:e.profileUrl,alt:"profile pic"}),Object(j.jsxs)("div",{className:"details",children:[Object(j.jsxs)("div",{children:[Object(j.jsx)("span",{children:e.name}),Object(j.jsxs)("span",{children:["\xa0",e.email]})]}),Object(j.jsx)("div",{className:"buttons",children:Object(j.jsxs)("div",{className:"center addFriend",onClick:function(){return function(e){var t,a=new u.a,n=(null===(t=a.getCurrentUser())||void 0===t?void 0:t.email)||"";a.sendRequest(Object(o.c)(n),Object(o.c)(e.email)).then((function(t){C(Object(i.h)(Object(i.f)(e.name))),Object(o.a)(1,w)})).catch((function(t){C(Object(i.c)(Object(i.d)(e.name))),Object(o.a)(1,w)}))}(e)},children:[Object(j.jsx)(s.a,{icon:c.l}),"Add"]})})]})]})})},t)})),v&&h.length<=0&&Object(j.jsxs)("div",{className:"noResults",children:["No Results related to\xa0",Object(j.jsx)("strong",{children:x})]}),!v&&Object(j.jsx)("div",{className:"notSearched",children:"Search for new friends"})]}),Object(j.jsx)("div",{className:"closeButton",children:Object(j.jsxs)("div",{className:"center",onClick:e.hideSearchPopUp,children:[Object(j.jsx)(s.a,{icon:c.a}),"Close"]})})]}),Object(j.jsx)(d.a,{time:1,message:k.message,type:k.type,showToast:k.showToast})]})}},68:function(e,t,a){},69:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var n=function(e,t){var a=parseInt(e,10),n=t.val(),c=0;return Object.keys(n).forEach((function(e){n[e].timestamp>a&&c++})),c}}}]);
//# sourceMappingURL=10.a2ba974e.chunk.js.map